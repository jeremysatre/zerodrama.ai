<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SNKPBL0P7Q"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-SNKPBL0P7Q');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action Plan Builder | ZeroDrama.ai</title>
    <meta name="description" content="Build your personalized change management action plan. Get diagnostic labels, scripts for hard conversations, and step-by-step guidance.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #1a2b4a;
            --navy-dark: #0f1a2e;
            --steel-blue: #5889A8;
            --lime: #B8D84F;
            --lime-hover: #c9e860;
            --coral: #FF9A6C;
            --coral-hover: #ffab82;
            --off-white: #fafafa;
            --light-gray: #f0f2f5;
            --text-primary: #1a2b4a;
            --text-secondary: #5a6a7a;
            --glass-bg: rgba(26, 43, 74, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--navy-dark) 0%, var(--navy) 50%, var(--navy-dark) 100%);
            color: white;
            line-height: 1.7;
            min-height: 100vh;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            background: rgba(15, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 500;
            color: white;
            text-decoration: none;
        }

        .nav-logo span {
            color: var(--lime);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--lime);
        }

        /* Main Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 7rem 2rem 4rem;
        }

        /* Header */
        .tool-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .tool-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 4vw, 2.75rem);
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        .tool-header h1 span {
            color: var(--lime);
        }

        .tool-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Entry Mode Selection */
        .mode-selection {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .mode-card {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.75rem 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--lime);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mode-card:hover {
            border-color: var(--lime);
            transform: translateX(8px);
        }

        .mode-card:hover::before {
            opacity: 1;
        }

        .mode-card.selected {
            border-color: var(--lime);
            background: rgba(184, 216, 79, 0.1);
        }

        .mode-card.selected::before {
            opacity: 1;
        }

        .mode-icon {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .mode-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: white;
        }

        .mode-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
            font-style: italic;
        }

        /* Email Gate Step */
        .email-step {
            display: none;
            max-width: 500px;
            margin: 0 auto;
            animation: slideIn 0.4s ease-out;
        }

        .email-step.active {
            display: block;
        }

        .email-step-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
        }

        .email-step-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .email-step-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.75rem;
            margin-bottom: 0.75rem;
        }

        .email-step-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .email-step-form {
            margin-bottom: 1.5rem;
        }

        .email-step-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
            font-family: inherit;
            outline: none;
            margin-bottom: 1rem;
        }

        .email-step-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .email-step-input:focus {
            border-color: var(--lime);
        }

        .email-step-input.error {
            border-color: var(--coral);
        }

        .email-step-error {
            color: var(--coral);
            font-size: 0.9rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
            display: none;
        }

        .email-step-error.visible {
            display: block;
        }

        .email-step-btn {
            width: 100%;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--coral), #FF7E4A);
            color: var(--navy);
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .email-step-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 154, 108, 0.3);
        }

        .email-step-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .email-step-benefits {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1.5rem;
            text-align: left;
            padding: 1rem;
            background: rgba(184, 216, 79, 0.1);
            border-radius: 12px;
        }

        .email-step-benefit {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
        }

        .email-step-benefit span {
            color: var(--lime);
        }

        .email-step-back {
            margin-top: 1.5rem;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .email-step-back:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Intake Form */
        .intake-form {
            display: none;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            backdrop-filter: blur(10px);
            animation: slideIn 0.4s ease-out;
        }

        .intake-form.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-progress {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: var(--lime);
            width: 30px;
            border-radius: 5px;
        }

        .progress-dot.completed {
            background: var(--lime);
        }

        .question-container {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .question-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .question-number {
            font-size: 0.85rem;
            color: var(--lime);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .question-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        .question-subtext {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        /* Form Controls */
        .option-grid {
            display: grid;
            gap: 0.75rem;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            color: white;
            font-size: 0.95rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .option-btn.selected {
            background: rgba(184, 216, 79, 0.2);
            border-color: var(--lime);
        }

        .option-btn.multi-select.selected::after {
            content: ' ‚úì';
            color: var(--lime);
            font-weight: bold;
        }

        textarea.text-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            outline: none;
            transition: border-color 0.3s ease;
            min-height: 120px;
        }

        textarea.text-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        textarea.text-input:focus {
            border-color: var(--lime);
        }

        /* Navigation Buttons */
        .form-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--glass-border);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }

        .btn-back {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--glass-border);
        }

        .btn-back:hover {
            border-color: white;
            color: white;
        }

        .btn-next {
            background: var(--lime);
            color: var(--navy);
        }

        .btn-next:hover {
            background: var(--lime-hover);
            transform: translateY(-2px);
        }

        .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--coral), #FF7E4A) !important;
            color: var(--navy);
            padding: 1rem 2.5rem;
            font-size: 1rem;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, var(--coral-hover), var(--coral)) !important;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 154, 108, 0.3);
        }

        /* Results Section */
        .results-container {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .results-container.active {
            display: block;
        }

        /* Diagnostic Summary Card */
        .diagnostic-summary {
            background: linear-gradient(135deg, rgba(88, 137, 168, 0.3), rgba(26, 43, 74, 0.8));
            border: 2px solid var(--steel-blue);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .diagnostic-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .diagnostic-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .diagnostic-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .diagnostic-date {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        .diagnostic-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .diagnostic-label {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .label-situation {
            background: rgba(184, 216, 79, 0.2);
            border: 1px solid var(--lime);
            color: var(--lime);
        }

        .label-issue {
            background: rgba(255, 154, 108, 0.2);
            border: 1px solid var(--coral);
            color: var(--coral);
        }

        .label-authority {
            background: rgba(88, 137, 168, 0.3);
            border: 1px solid var(--steel-blue);
            color: #8bb8d4;
        }

        .label-urgency {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff8a8a;
        }

        .label-urgency.low {
            background: rgba(100, 200, 100, 0.2);
            border-color: #6bc96b;
            color: #8ada8a;
        }

        .diagnostic-inputs {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 1rem 1.25rem;
        }

        .diagnostic-inputs-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 0.75rem;
        }

        .diagnostic-input-item {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            padding: 0.25rem 0;
        }

        /* Results Section Cards */
        .results-section {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .results-section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }

        .results-section-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--lime), #9bc23c);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .results-section h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .results-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
        }

        .results-content p {
            margin-bottom: 1rem;
        }

        /* Script Box - Copyable */
        .script-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(184, 216, 79, 0.3);
            border-radius: 12px;
            padding: 1.25rem;
            margin: 1rem 0;
            position: relative;
        }

        .script-box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .script-box-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--lime);
            font-weight: 600;
        }

        .script-box-content {
            font-style: italic;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.6;
        }

        .script-box.avoid {
            border-color: rgba(255, 100, 100, 0.3);
        }

        .script-box.avoid .script-box-label {
            color: #ff8a8a;
        }

        /* Action Checklist */
        .action-checklist {
            list-style: none;
            padding: 0;
        }

        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--lime);
            border-radius: 6px;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            margin-top: 2px;
        }

        .action-checkbox.checked {
            background: var(--lime);
        }

        .action-checkbox.checked::after {
            content: '‚úì';
            color: var(--navy);
            font-weight: bold;
            font-size: 0.85rem;
        }

        .action-text {
            flex: 1;
        }

        .action-text.checked {
            text-decoration: line-through;
            opacity: 0.6;
        }

        /* Report Actions Bar */
        .report-actions {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn-report {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .btn-email {
            background: linear-gradient(135deg, var(--coral), #FF7E4A);
            color: var(--navy);
        }

        .btn-email:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 154, 108, 0.3);
        }

        .btn-download {
            background: var(--steel-blue);
            color: white;
        }

        .btn-download:hover {
            background: #6a9ab8;
            transform: translateY(-2px);
        }

        /* Email Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 26, 46, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 450px;
            width: 100%;
            animation: slideIn 0.3s ease-out;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-icon {
            font-size: 3rem;
            margin-bottom: 0.75rem;
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .modal-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .modal-form {
            margin-bottom: 1.5rem;
        }

        .modal-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
            font-family: inherit;
            outline: none;
            margin-bottom: 1rem;
        }

        .modal-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .modal-input:focus {
            border-color: var(--lime);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
        }

        .modal-buttons .btn {
            flex: 1;
            justify-content: center;
        }

        .btn-cancel {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--glass-border);
        }

        .btn-send {
            background: linear-gradient(135deg, var(--coral), #FF7E4A);
            color: var(--navy);
        }

        /* Chat Refinement */
        .chat-refinement {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .chat-refinement h4 {
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-refinement h4::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--lime);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding-right: 0.5rem;
        }

        .chat-message {
            padding: 0.875rem 1rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .chat-message.user {
            background: var(--lime);
            color: var(--navy);
            margin-left: 20%;
        }

        .chat-message.bot {
            background: rgba(88, 137, 168, 0.3);
            margin-right: 20%;
        }

        .chat-input-area {
            display: flex;
            gap: 0.75rem;
        }

        .chat-input-area input {
            flex: 1;
            padding: 0.875rem 1.25rem;
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 0.95rem;
            font-family: inherit;
            outline: none;
        }

        .chat-input-area input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .chat-input-area input:focus {
            border-color: var(--lime);
        }

        .chat-send-btn {
            width: 48px;
            height: 48px;
            background: var(--lime);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: var(--lime-hover);
            transform: scale(1.05);
        }

        .chat-send-btn svg {
            width: 20px;
            height: 20px;
            stroke: var(--navy);
        }

        /* Loading State */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 26, 46, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 1.5rem;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--glass-border);
            border-top-color: var(--lime);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Success Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--lime);
            color: var(--navy);
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .container {
                padding: 6rem 1.25rem 3rem;
            }

            .intake-form {
                padding: 1.5rem;
            }

            .mode-card {
                padding: 1.25rem 1.5rem;
            }

            .question-text {
                font-size: 1.25rem;
            }

            .form-nav {
                flex-direction: column;
                gap: 1rem;
            }

            .form-nav .btn {
                width: 100%;
                justify-content: center;
            }

            .report-actions {
                flex-direction: column;
            }

            .btn-report {
                width: 100%;
                justify-content: center;
            }

            .diagnostic-header {
                flex-direction: column;
            }

            .modal-buttons {
                flex-direction: column;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                color: black;
                font-size: 11pt;
                line-height: 1.5;
            }

            nav, .report-actions, .chat-refinement, #btn-start-over, .loading-overlay, .modal-overlay, .toast {
                display: none !important;
            }

            .container {
                padding: 0.5in;
                max-width: 100%;
            }

            .diagnostic-summary {
                background: #f8f9fa !important;
                border: 2px solid #333 !important;
                color: black !important;
                padding: 1.5rem !important;
                margin-bottom: 0.5in !important;
                page-break-after: always;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .diagnostic-summary * {
                color: black !important;
            }

            .diagnostic-title {
                font-size: 18pt !important;
                font-weight: bold !important;
            }

            .diagnostic-label {
                background: #e9ecef !important;
                border: 1px solid #666 !important;
                color: #333 !important;
                padding: 0.25rem 0.75rem !important;
            }

            .diagnostic-inputs {
                background: #f0f0f0 !important;
            }

            .results-section {
                background: white !important;
                border: 1px solid #ccc !important;
                color: black !important;
                padding: 1rem !important;
                margin-bottom: 1rem !important;
                page-break-inside: avoid;
                page-break-after: auto;
            }

            .results-section:nth-child(3n) {
                page-break-after: always;
            }

            .results-section * {
                color: black !important;
            }

            .results-section-icon {
                background: #e9ecef !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .results-section h3 {
                font-size: 14pt !important;
                border-bottom: 1px solid #ccc;
                padding-bottom: 0.5rem;
            }

            .script-box {
                background: #f9f9f9 !important;
                border: 1px solid #999 !important;
                page-break-inside: avoid;
            }

            .script-box * {
                color: black !important;
            }

            .script-box.avoid {
                background: #fff0f0 !important;
                border-color: #cc0000 !important;
            }

            .script-box-label {
                font-weight: bold !important;
            }

            .action-checklist {
                page-break-inside: avoid;
            }

            .action-checkbox {
                border: 2px solid #333 !important;
                width: 16px !important;
                height: 16px !important;
            }

            /* Header for each printed page */
            @page {
                margin: 0.75in;
            }
        }

        /* Scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="/" class="nav-logo">Zero<span>Drama</span>.ai</a>
            <ul class="nav-links">
                <li><a href="/#about">About</a></li>
                <li><a href="/#compare">Compare</a></li>
                <li><a href="/#quick-advice">Quick Advice</a></li>
                <li><a href="/#contact">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Analyzing your situation...</div>
    </div>

    <!-- Email Modal -->
    <div class="modal-overlay" id="email-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon">üìß</div>
                <div class="modal-title">Send a Copy</div>
                <div class="modal-subtitle">Get a copy of this report sent to your inbox for easy reference.</div>
            </div>
            <div class="modal-form">
                <input type="email" class="modal-input" id="email-input" placeholder="your@email.com">
                <input type="text" class="modal-input" id="name-input" placeholder="Your name (optional)">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-cancel" onclick="closeEmailModal()">Cancel</button>
                <button class="btn btn-send" onclick="sendEmailReport()">üì§ Send Copy</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">Copied to clipboard!</div>

    <div class="container">
        <!-- Header -->
        <div class="tool-header">
            <h1>Action <span>Plan</span> Builder</h1>
            <p>Get your personalized diagnosis, scripts for hard conversations, and step-by-step action plan. Takes 3 minutes.</p>
        </div>

        <!-- Step 1: Entry Mode Selection -->
        <div id="mode-step">
            <div class="mode-selection">
                <div class="mode-card" data-mode="conversation">
                    <div class="mode-icon">üéØ</div>
                    <div class="mode-title">A Critical Conversation is Coming</div>
                    <div class="mode-description">"I need to talk to someone about this change and I don't want it to blow up."</div>
                </div>

                <div class="mode-card" data-mode="stalled">
                    <div class="mode-icon">üîç</div>
                    <div class="mode-title">This Initiative is Stalling</div>
                    <div class="mode-description">"We're stuck, and everyone has a different explanation."</div>
                </div>

                <div class="mode-card" data-mode="middle">
                    <div class="mode-icon">‚öñÔ∏è</div>
                    <div class="mode-title">I'm Caught in the Middle</div>
                    <div class="mode-description">"Leadership expects results, my team is struggling, and I'm stuck between them."</div>
                </div>
            </div>
        </div>

        <!-- Step 1.5: Email Gate -->
        <div class="email-step" id="email-step">
            <div class="email-step-card">
                <div class="email-step-icon">üìã</div>
                <div class="email-step-title">Get Your Free Action Plan</div>
                <div class="email-step-subtitle">
                    Enter your email to receive your personalized diagnosis, conversation scripts, and step-by-step action plan.
                </div>
                <div class="email-step-form">
                    <input type="email" class="email-step-input" id="gate-email-input" placeholder="your@email.com" autocomplete="email">
                    <div class="email-step-error" id="gate-email-error">Please enter a valid email address</div>
                    <input type="text" class="email-step-input" id="gate-name-input" placeholder="Your name (optional)" autocomplete="name">
                    <button class="email-step-btn" id="gate-continue-btn" onclick="submitGateEmail()">
                        Continue to Your Action Plan ‚Üí
                    </button>
                </div>
                <div class="email-step-benefits">
                    <div class="email-step-benefit"><span>‚úì</span> Diagnostic labels for your situation</div>
                    <div class="email-step-benefit"><span>‚úì</span> Scripts you can copy and use</div>
                    <div class="email-step-benefit"><span>‚úì</span> Step-by-step action checklist</div>
                    <div class="email-step-benefit"><span>‚úì</span> Downloadable PDF report</div>
                </div>
                <div class="email-step-back" onclick="backToModeSelection()">‚Üê Choose a different situation</div>
            </div>
        </div>

        <!-- Step 2: Intake Form -->
        <div class="intake-form" id="intake-form">
            <div class="form-progress" id="progress-dots"></div>
            <div id="questions-container"></div>
            <div class="form-nav">
                <button class="btn btn-back" id="btn-back">‚Üê Back</button>
                <button class="btn btn-next" id="btn-next">Continue ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Results -->
        <div class="results-container" id="results">
            
            <!-- Report Actions -->
            <div class="report-actions">
                <button class="btn-report btn-email" onclick="openEmailModal()">
                    üìß Email This Report
                </button>
                <button class="btn-report btn-download" onclick="downloadPDF()">
                    üìÑ Download PDF
                </button>
            </div>

            <!-- Diagnostic Summary -->
            <div class="diagnostic-summary" id="diagnostic-summary">
                <div class="diagnostic-header">
                    <div>
                        <div class="diagnostic-title">Your Action Plan</div>
                        <div class="diagnostic-subtitle">Personalized action plan from ZeroDrama.ai</div>
                    </div>
                    <div class="diagnostic-date" id="report-date"></div>
                </div>
                <div class="diagnostic-labels" id="diagnostic-labels">
                    <!-- Labels generated by JS -->
                </div>
                <div class="diagnostic-inputs">
                    <div class="diagnostic-inputs-title">Your Situation Summary</div>
                    <div id="situation-summary">
                        <!-- Summary generated by JS -->
                    </div>
                </div>
            </div>

            <!-- Results Content -->
            <div id="results-content">
                <!-- Filled by API response -->
            </div>

            <!-- Chat Refinement -->
            <div class="chat-refinement">
                <h4>Need clarification or want to go deeper?</h4>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Ask a follow-up question...">
                    <button class="chat-send-btn" id="chat-send-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-back" id="btn-start-over">‚Üê Start New Assessment</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let currentMode = null;
        let currentQuestionIndex = 0;
        let answers = {};
        let conversationHistory = [];
        let fullReportText = '';
        let diagnosticLabels = {};

        // ============================================
        // QUESTION DEFINITIONS BY MODE
        // ============================================
        const questionSets = {
            conversation: [
                {
                    id: 'who',
                    question: 'Who is this conversation with?',
                    subtext: 'Power dynamics shape everything about how to approach this.',
                    type: 'multi-select',
                    options: ['Direct report', 'Peer or colleague', 'Manager or leadership', 'Executive sponsor', 'Cross-functional team', 'External stakeholder']
                },
                {
                    id: 'change_type',
                    question: 'What is the change about?',
                    subtext: 'Different changes trigger different types of resistance.',
                    type: 'single-select',
                    options: ['New technology or system', 'Process or workflow change', 'Role or responsibility shift', 'Organizational restructure', 'Strategy or priority shift', 'Something else']
                },
                {
                    id: 'resistance',
                    question: 'What resistance are you seeing or expecting?',
                    subtext: 'Identifying the pattern helps determine the approach.',
                    type: 'multi-select',
                    options: ['Open pushback or vocal opposition', 'Passive compliance (sure, whatever)', 'Silence or avoidance', 'Emotional reactions', 'They say yes but act no', 'Not sure yet']
                },
                {
                    id: 'internal_state',
                    question: 'Be honest - what is hardest for YOU about this?',
                    subtext: 'Separating your friction from theirs is critical.',
                    type: 'multi-select',
                    options: ['I do not want conflict', 'I am frustrated or irritated', 'I am unsure of my authority', 'I feel caught in the middle', 'I do not fully agree with the change', 'I am emotionally drained']
                },
                {
                    id: 'authority',
                    question: 'What is your actual authority here?',
                    subtext: 'This prevents over-promising what you can deliver.',
                    type: 'single-select',
                    options: ['I can decide this', 'I can influence but not decide', 'I am delivering someone elses decision', 'I honestly do not know']
                },
                {
                    id: 'timing',
                    question: 'When is this conversation happening?',
                    subtext: 'This calibrates depth vs. speed of guidance.',
                    type: 'single-select',
                    options: ['Today', 'This week', 'Soon, but not scheduled', 'I have been avoiding it']
                },
                {
                    id: 'stakes',
                    question: 'What is at risk if this goes poorly?',
                    subtext: 'Understanding stakes helps prioritize what matters.',
                    type: 'multi-select',
                    options: ['Loss of trust or relationship damage', 'Delay or failure of the initiative', 'Escalation to leadership', 'Team disengagement', 'My personal credibility', 'Other']
                },
                {
                    id: 'outcome',
                    question: 'What would success look like after this conversation?',
                    subtext: 'Be specific - this anchors the whole plan.',
                    type: 'text',
                    placeholder: 'e.g., "They agree to pilot the new process" or "We have clarity on next steps even if they disagree"'
                }
            ],
            stalled: [
                {
                    id: 'initiative',
                    question: 'What change initiative are you working on?',
                    subtext: 'Give us context on what you are trying to accomplish.',
                    type: 'text',
                    placeholder: 'e.g., Rolling out new CRM, process redesign, org restructure'
                },
                {
                    id: 'timeline',
                    question: 'How long has this initiative been running?',
                    subtext: 'Timing affects diagnosis.',
                    type: 'single-select',
                    options: ['Still in planning (not launched)', '1-4 weeks', '1-3 months', '3-6 months', '6+ months']
                },
                {
                    id: 'adoption',
                    question: 'What is the current adoption or engagement level?',
                    subtext: 'Where are people actually at?',
                    type: 'single-select',
                    options: ['Not launched yet', '0-25% - Most are not using it', '26-50% - Some adoption, lots of gaps', '51-75% - Decent but inconsistent', '76-100% - Strong adoption']
                },
                {
                    id: 'symptoms',
                    question: 'What symptoms are you seeing?',
                    subtext: 'Check all that apply.',
                    type: 'multi-select',
                    options: ['Missed milestones or timeline slipping', 'People say yes but do not follow through', 'Blame-shifting between teams', 'Quiet disengagement or people checking out', 'Leadership losing patience', 'Confusion about who owns what', 'Training done but not applied']
                },
                {
                    id: 'root_cause_guess',
                    question: 'What do YOU think is the root cause?',
                    subtext: 'Your instinct matters - we will validate or challenge it.',
                    type: 'single-select',
                    options: ['Active resistance from key people', 'Poor design - the change itself has problems', 'Misalignment - different goals or priorities', 'Change saturation - too many changes at once', 'Unclear ownership or accountability', 'Leadership is not really behind it', 'I do not know']
                },
                {
                    id: 'tried',
                    question: 'What have you already tried?',
                    subtext: 'So we do not suggest things you have done.',
                    type: 'multi-select',
                    options: ['More training', 'More communication or emails', 'Leadership town hall', '1:1 conversations with resisters', 'Incentives or consequences', 'Project timeline adjustments', 'Nothing significant yet']
                },
                {
                    id: 'authority_stalled',
                    question: 'What can you actually control here?',
                    subtext: 'This shapes realistic recommendations.',
                    type: 'single-select',
                    options: ['I own this initiative end-to-end', 'I influence but do not control key decisions', 'I am executing someone elses plan', 'It is unclear']
                },
                {
                    id: 'unblock_goal',
                    question: 'What would unstuck look like in the next 30 days?',
                    subtext: 'Be realistic about near-term progress.',
                    type: 'text',
                    placeholder: 'e.g., "Key team starts using the new system daily" or "We identify and address the real blockers"'
                }
            ],
            middle: [
                {
                    id: 'situation',
                    question: 'Describe your situation in a few sentences.',
                    subtext: 'What is the change, and where are you stuck between parties?',
                    type: 'text',
                    placeholder: 'e.g., "Leadership wants faster rollout, my team says they need more time, and I am supposed to make both happy."'
                },
                {
                    id: 'upward_pressure',
                    question: 'What is leadership expecting from you?',
                    subtext: 'What is the explicit or implicit demand?',
                    type: 'multi-select',
                    options: ['Faster results or timeline pressure', 'Higher adoption numbers', 'Less noise or fewer complaints', 'Me to handle it or make problems go away', 'Visible progress reports', 'Not clear - mixed messages']
                },
                {
                    id: 'downward_reality',
                    question: 'What is your team actually experiencing?',
                    subtext: 'What are they telling you (or not telling you)?',
                    type: 'multi-select',
                    options: ['Overwhelmed - too many changes at once', 'Do not understand why this matters', 'Have not been given time to adjust', 'The change does not work for them', 'They are complying but resentful', 'Afraid to speak up', 'Actually doing fine - leadership does not see it']
                },
                {
                    id: 'your_position',
                    question: 'How are you feeling in this role?',
                    subtext: 'Be honest - this matters.',
                    type: 'multi-select',
                    options: ['Exhausted from translating between both sides', 'Frustrated - I agree with my team but cannot say it', 'Pressured to sugarcoat reality upward', 'Unclear on what I am actually supposed to do', 'Worried about my own credibility', 'Actually okay - I just need tactics']
                },
                {
                    id: 'authority_middle',
                    question: 'What can you actually control?',
                    subtext: 'Realistic boundaries help.',
                    type: 'single-select',
                    options: ['I can push back on leadership timeline or demands', 'I can advocate but rarely win', 'I can only control how I communicate', 'I have no real leverage on either side']
                },
                {
                    id: 'support',
                    question: 'Who else could help carry this?',
                    subtext: 'You do not have to do this alone.',
                    type: 'multi-select',
                    options: ['A peer in a similar position', 'My own manager', 'HR or Change Management team', 'An executive champion', 'No one - I am isolated', 'I have not asked anyone yet']
                },
                {
                    id: 'clarity_goal',
                    question: 'What would help you most right now?',
                    subtext: 'What outcome are you looking for from this tool?',
                    type: 'single-select',
                    options: ['Language for a conversation with leadership', 'Language for a conversation with my team', 'Help clarifying what is actually my job', 'A way to protect my own wellbeing', 'A plan to make real progress', 'All of the above']
                }
            ]
        };

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.mode-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectMode(this.dataset.mode);
                });
            });

            document.getElementById('btn-back').addEventListener('click', previousQuestion);
            document.getElementById('btn-next').addEventListener('click', nextQuestion);
            document.getElementById('btn-start-over').addEventListener('click', startOver);

            document.getElementById('chat-input').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') sendChatMessage();
            });
            document.getElementById('chat-send-btn').addEventListener('click', sendChatMessage);
        });

        // ============================================
        // MODE SELECTION
        // ============================================
        function selectMode(mode) {
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('selected');

            currentMode = mode;
            currentQuestionIndex = 0;
            answers = { mode: mode };

            // Show email gate step instead of going directly to intake
            setTimeout(() => {
                document.getElementById('mode-step').style.display = 'none';
                document.getElementById('email-step').classList.add('active');
                document.getElementById('gate-email-input').focus();
            }, 300);
        }

        // ============================================
        // EMAIL GATE FUNCTIONS
        // ============================================
        let capturedEmail = '';
        let capturedName = '';

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function submitGateEmail() {
            const emailInput = document.getElementById('gate-email-input');
            const nameInput = document.getElementById('gate-name-input');
            const errorEl = document.getElementById('gate-email-error');
            const email = emailInput.value.trim();
            const name = nameInput.value.trim();

            // Validate email
            if (!validateEmail(email)) {
                emailInput.classList.add('error');
                errorEl.classList.add('visible');
                return;
            }

            // Clear error state
            emailInput.classList.remove('error');
            errorEl.classList.remove('visible');

            // Store for later use
            capturedEmail = email;
            capturedName = name;

            // Track email capture
            gtag('event', 'email_captured', {
                'event_category': 'conversion',
                'event_label': currentMode
            });

            // Proceed to intake form
            document.getElementById('email-step').classList.remove('active');
            document.getElementById('intake-form').classList.add('active');
            buildQuestions();
            showQuestion(0);
        }

        function backToModeSelection() {
            document.getElementById('email-step').classList.remove('active');
            document.getElementById('mode-step').style.display = 'block';
            // Clear any selected mode
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // Allow Enter key to submit email
        document.addEventListener('DOMContentLoaded', function() {
            const gateEmailInput = document.getElementById('gate-email-input');
            if (gateEmailInput) {
                gateEmailInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        submitGateEmail();
                    }
                });
            }
        });

        // ============================================
        // FORM BUILDING
        // ============================================
        function buildQuestions() {
            const questions = questionSets[currentMode];
            const container = document.getElementById('questions-container');
            const progressContainer = document.getElementById('progress-dots');

            progressContainer.innerHTML = questions.map((_, i) => 
                `<div class="progress-dot" data-index="${i}"></div>`
            ).join('');

            container.innerHTML = questions.map((q, i) => {
                let inputHTML = '';

                if (q.type === 'single-select' || q.type === 'multi-select') {
                    const isMulti = q.type === 'multi-select';
                    inputHTML = `<div class="option-grid">
                        ${q.options.map((opt, optIndex) => 
                            `<button type="button" class="option-btn ${isMulti ? 'multi-select' : ''}" 
                                data-question="${q.id}" 
                                data-value="${optIndex}"
                                data-multi="${isMulti}">${opt}</button>`
                        ).join('')}
                    </div>`;
                } else if (q.type === 'text') {
                    inputHTML = `<textarea class="text-input" data-question="${q.id}" placeholder="${q.placeholder || ''}"></textarea>`;
                }

                return `
                    <div class="question-container" data-index="${i}">
                        <div class="question-number">Question ${i + 1} of ${questions.length}</div>
                        <div class="question-text">${q.question}</div>
                        <div class="question-subtext">${q.subtext}</div>
                        ${inputHTML}
                    </div>
                `;
            }).join('');

            container.querySelectorAll('.option-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    handleOptionClick(this);
                });
            });

            container.querySelectorAll('.text-input').forEach(textarea => {
                textarea.addEventListener('input', function() {
                    answers[this.dataset.question] = this.value;
                    updateNextButtonState();
                });
            });
        }

        function handleOptionClick(btn) {
            const questionId = btn.dataset.question;
            const valueIndex = parseInt(btn.dataset.value);
            const isMulti = btn.dataset.multi === 'true';
            const questions = questionSets[currentMode];
            const question = questions.find(q => q.id === questionId);
            const actualValue = question.options[valueIndex];

            if (isMulti) {
                btn.classList.toggle('selected');
                if (!answers[questionId]) answers[questionId] = [];
                
                if (btn.classList.contains('selected')) {
                    answers[questionId].push(actualValue);
                } else {
                    answers[questionId] = answers[questionId].filter(v => v !== actualValue);
                }
            } else {
                document.querySelectorAll(`[data-question="${questionId}"]`).forEach(b => {
                    b.classList.remove('selected');
                });
                btn.classList.add('selected');
                answers[questionId] = actualValue;
            }
            updateNextButtonState();
        }

        function showQuestion(index) {
            const questions = questionSets[currentMode];
            
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });

            document.querySelector(`.question-container[data-index="${index}"]`).classList.add('active');

            document.querySelectorAll('.progress-dot').forEach((dot, i) => {
                dot.classList.remove('active', 'completed');
                if (i < index) dot.classList.add('completed');
                if (i === index) dot.classList.add('active');
            });

            const backBtn = document.getElementById('btn-back');
            const nextBtn = document.getElementById('btn-next');

            backBtn.style.visibility = index === 0 ? 'hidden' : 'visible';

            if (index === questions.length - 1) {
                nextBtn.textContent = 'Get My Action Plan ‚Üí';
                nextBtn.classList.add('btn-submit');
            } else {
                nextBtn.textContent = 'Continue ‚Üí';
                nextBtn.classList.remove('btn-submit');
            }

            currentQuestionIndex = index;
            updateNextButtonState();
        }

        function updateNextButtonState() {
            const questions = questionSets[currentMode];
            const currentQ = questions[currentQuestionIndex];
            const answer = answers[currentQ.id];

            const hasAnswer = answer && (
                (typeof answer === 'string' && answer.trim().length > 0) ||
                (Array.isArray(answer) && answer.length > 0)
            );

            document.getElementById('btn-next').disabled = !hasAnswer;
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function nextQuestion() {
            const questions = questionSets[currentMode];
            
            if (currentQuestionIndex < questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            } else {
                submitAssessment();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            } else {
                document.getElementById('intake-form').classList.remove('active');
                document.getElementById('mode-step').style.display = 'block';
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.classList.remove('selected');
                });
                currentMode = null;
                answers = {};
            }
        }

        function startOver() {
            document.getElementById('results').classList.remove('active');
            document.getElementById('mode-step').style.display = 'block';
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });
            currentMode = null;
            currentQuestionIndex = 0;
            answers = {};
            conversationHistory = [];
            fullReportText = '';
            document.getElementById('chat-messages').innerHTML = '';
        }

        // ============================================
        // DIAGNOSTIC LABELS GENERATION
        // ============================================
        function generateDiagnosticLabels() {
            const labels = [];
            const modeLabels = {
                conversation: 'Critical Conversation',
                stalled: 'Stalled Initiative',
                middle: 'Caught in the Middle'
            };

            // Situation type
            labels.push({
                type: 'situation',
                text: modeLabels[currentMode]
            });

            // Authority level
            const authority = answers.authority || answers.authority_stalled || answers.authority_middle;
            if (authority) {
                let authorityLabel = 'Authority: ';
                if (authority.includes('decide')) authorityLabel += 'Decision Maker';
                else if (authority.includes('influence')) authorityLabel += 'Influencer Only';
                else if (authority.includes('delivering') || authority.includes('executing')) authorityLabel += 'Messenger';
                else authorityLabel += 'Unclear';
                
                labels.push({ type: 'authority', text: authorityLabel });
            }

            // Urgency
            const timing = answers.timing;
            if (timing) {
                let urgency = { type: 'urgency', text: 'Urgency: ' };
                if (timing === 'Today') { urgency.text += 'Immediate'; urgency.level = 'high'; }
                else if (timing === 'This week') { urgency.text += 'High'; urgency.level = 'high'; }
                else if (timing === 'Soon, but not scheduled') { urgency.text += 'Medium'; urgency.level = 'medium'; }
                else { urgency.text += 'Low'; urgency.level = 'low'; }
                labels.push(urgency);
            }

            // Root cause guess (for stalled)
            const rootCause = answers.root_cause_guess;
            if (rootCause && rootCause !== 'I do not know') {
                let issueLabel = 'Primary Issue: ';
                if (rootCause.includes('resistance')) issueLabel += 'Active Resistance';
                else if (rootCause.includes('Poor design')) issueLabel += 'Design Problem';
                else if (rootCause.includes('Misalignment')) issueLabel += 'Misalignment';
                else if (rootCause.includes('saturation')) issueLabel += 'Change Saturation';
                else if (rootCause.includes('ownership')) issueLabel += 'Unclear Ownership';
                else if (rootCause.includes('Leadership')) issueLabel += 'Sponsor Gap';
                else issueLabel += rootCause;
                
                labels.push({ type: 'issue', text: issueLabel });
            }

            return labels;
        }

        function generateSituationSummary() {
            const summaryItems = [];
            const questions = questionSets[currentMode];

            // Get key answers to summarize
            questions.forEach(q => {
                const answer = answers[q.id];
                if (answer && q.id !== 'outcome' && q.id !== 'unblock_goal' && q.id !== 'clarity_goal') {
                    const answerStr = Array.isArray(answer) ? answer.join(', ') : answer;
                    if (answerStr.length < 100) { // Only short answers
                        summaryItems.push(`<div class="diagnostic-input-item">‚Ä¢ <strong>${q.question.replace('?', '')}:</strong> ${answerStr}</div>`);
                    }
                }
            });

            return summaryItems.slice(0, 5).join(''); // Limit to 5 items
        }

        // ============================================
        // API SUBMISSION
        // ============================================
        async function submitAssessment() {
            const loading = document.getElementById('loading');
            loading.classList.add('active');

            try {
                const response = await callClaudeAPI(buildInitialPrompt());
                
                loading.classList.remove('active');
                document.getElementById('intake-form').classList.remove('active');
                
                // Generate diagnostic labels
                const labels = generateDiagnosticLabels();
                displayDiagnosticSummary(labels);
                
                displayResults(response);
                document.getElementById('results').classList.add('active');

                // Track event
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'diagnostic_completed', {
                        'event_category': 'engagement',
                        'event_label': currentMode
                    });
                }

            } catch (error) {
                loading.classList.remove('active');
                console.error('API Error:', error);
                alert('Sorry, there was an error processing your request. Please try again.\n\nError: ' + error.message);
            }
        }

        function displayDiagnosticSummary(labels) {
            // Set date
            const now = new Date();
            document.getElementById('report-date').textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            });

            // Display labels
            const labelsContainer = document.getElementById('diagnostic-labels');
            labelsContainer.innerHTML = labels.map(label => {
                let className = 'diagnostic-label ';
                if (label.type === 'situation') className += 'label-situation';
                else if (label.type === 'issue') className += 'label-issue';
                else if (label.type === 'authority') className += 'label-authority';
                else if (label.type === 'urgency') className += 'label-urgency' + (label.level === 'low' ? ' low' : '');
                
                return `<span class="${className}">${label.text}</span>`;
            }).join('');

            // Display situation summary
            document.getElementById('situation-summary').innerHTML = generateSituationSummary();
        }

        function buildInitialPrompt() {
            const modeDescriptions = {
                conversation: 'A Critical Conversation is Coming',
                stalled: 'This Initiative is Stalling',
                middle: 'I am Caught in the Middle'
            };

            let prompt = `Entry Mode: ${modeDescriptions[currentMode]}\n\n`;
            prompt += 'User Inputs:\n';

            const questions = questionSets[currentMode];
            questions.forEach(q => {
                const answer = answers[q.id];
                if (answer) {
                    const answerStr = Array.isArray(answer) ? answer.join(', ') : answer;
                    prompt += `- ${q.question}: ${answerStr}\n`;
                }
            });

            prompt += '\nBased on these inputs, provide a comprehensive action plan.';

            return prompt;
        }

        async function callClaudeAPI(userMessage) {
            const systemPrompt = `You are the ZeroDrama.ai Change Navigation Assistant ‚Äî a tactical advisor for leaders navigating organizational transformation.

DESIGN CRITERIA ‚Äî EVERY RESPONSE MUST:
1. Address something PAINFUL RIGHT NOW (not theoretical)
2. Acknowledge REAL CONSEQUENCES if mishandled
3. End with CLEAR ACTION, not just reflection
4. Be relevant to organizational transformation contexts

RESPONSE FORMAT:
Structure your response with these exact sections (use these headers):

## üîç What's Really Happening
[Diagnosis of the root issue based on their inputs. Distinguish between: resistance, misalignment, poor design, change saturation, or unclear authority. Be specific and direct. 2-3 paragraphs max.]

## üéØ How to Frame This
[The strategic approach. What lens to use. What to acknowledge upfront. How to position yourself. 2-3 paragraphs max.]

## üí¨ Language to Use
[IMPORTANT: Provide 2-3 specific phrases or scripts they can actually say. Format each as a direct quote they can use verbatim. Be specific and practical.]

## üö´ Language to Avoid
[2-3 specific phrases or approaches that will backfire. Be direct about why each is problematic.]

## ‚û°Ô∏è Your Next 3 Steps
[Concrete, sequenced actions formatted as a numbered list. What to do first, second, third. Be specific about timing and what "done" looks like for each step.]

## ‚ö†Ô∏è Watch Out For
[2-3 red flags, common mistakes, or likely reactions to prepare for. Be specific.]

OPERATING PRINCIPLES:
- NEVER assume the user has full decision authority ‚Äî most don't
- ALWAYS consider power dynamics and role constraints
- Distinguish between resistance, poor design, misalignment, overload, and unclear authority
- Don't over-validate emotions without redirecting to clarity
- Be direct and practical, not academic

TONE: Calm. Grounded. Direct. Respectful. Practical.`;

            conversationHistory.push({ role: 'user', content: userMessage });

            const response = await fetch('https://zerodrama-api.jeremysatre.workers.dev/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-5-20250929',
                    max_tokens: 4096,
                    system: systemPrompt,
                    messages: conversationHistory
                })
            });

            const data = await response.json();

            if (!response.ok || data.error) {
                throw new Error(data.error?.message || `API error: ${response.status}`);
            }

            const assistantMessage = data.content[0].text;
            conversationHistory.push({ role: 'assistant', content: assistantMessage });
            fullReportText = assistantMessage;

            return assistantMessage;
        }

        // ============================================
        // RESULTS DISPLAY
        // ============================================
        function displayResults(response) {
            const container = document.getElementById('results-content');
            const sections = parseResponseSections(response);
            
            container.innerHTML = sections.map(section => {
                let content = section.content;
                
                // Check if this is a "Language to Use" section - make it copyable
                if (section.title.includes('Language to Use')) {
                    content = formatWithScriptBoxes(content, false);
                } else if (section.title.includes('Avoid')) {
                    content = formatWithScriptBoxes(content, true);
                } else if (section.title.includes('Next')) {
                    content = formatAsChecklist(content);
                } else {
                    content = formatContent(content);
                }

                return `
                    <div class="results-section">
                        <div class="results-section-header">
                            <div class="results-section-icon">${section.icon}</div>
                            <h3>${section.title}</h3>
                        </div>
                        <div class="results-content">${content}</div>
                    </div>
                `;
            }).join('');

            // Add event listeners for checkboxes
            document.querySelectorAll('.action-checkbox').forEach(checkbox => {
                checkbox.addEventListener('click', function() {
                    this.classList.toggle('checked');
                    this.nextElementSibling.classList.toggle('checked');
                });
            });
        }

        function parseResponseSections(response) {
            const sectionPatterns = [
                { pattern: /##\s*üîç\s*What['']?s Really Happening[^\n]*/i, icon: 'üîç', title: "What's Really Happening" },
                { pattern: /##\s*üéØ\s*How to Frame[^\n]*/i, icon: 'üéØ', title: 'How to Frame This' },
                { pattern: /##\s*üí¨\s*Language to Use[^\n]*/i, icon: 'üí¨', title: 'Language to Use' },
                { pattern: /##\s*üö´\s*Language to Avoid[^\n]*/i, icon: 'üö´', title: 'Language to Avoid' },
                { pattern: /##\s*‚û°Ô∏è\s*Your Next[^\n]*/i, icon: '‚û°Ô∏è', title: 'Your Next Steps' },
                { pattern: /##\s*‚ö†Ô∏è\s*Watch Out[^\n]*/i, icon: '‚ö†Ô∏è', title: 'Watch Out For' }
            ];

            const sections = [];
            let remaining = response;

            sectionPatterns.forEach((sp, index) => {
                const match = remaining.match(sp.pattern);
                if (match) {
                    const startIndex = match.index + match[0].length;
                    let endIndex = remaining.length;

                    for (let i = index + 1; i < sectionPatterns.length; i++) {
                        const nextMatch = remaining.match(sectionPatterns[i].pattern);
                        if (nextMatch) {
                            endIndex = nextMatch.index;
                            break;
                        }
                    }

                    sections.push({
                        icon: sp.icon,
                        title: sp.title,
                        content: remaining.slice(startIndex, endIndex).trim()
                    });
                }
            });

            if (sections.length === 0) {
                sections.push({ icon: 'üìã', title: 'Your Action Plan', content: response });
            }

            return sections;
        }

        function formatContent(content) {
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                .replace(/^(.+)$/gm, (match) => {
                    if (!match.startsWith('<')) return `<p>${match}</p>`;
                    return match;
                });
        }

        function formatWithScriptBoxes(content, isAvoid) {
            // Find quoted text and make them script boxes
            const quotes = content.match(/"([^"]+)"/g) || [];
            let html = content;

            quotes.forEach((quote, index) => {
                const cleanQuote = quote.replace(/"/g, '');
                const boxClass = isAvoid ? 'script-box avoid' : 'script-box';
                const label = isAvoid ? `‚ùå Don't Say #${index + 1}` : `‚úì Say This #${index + 1}`;
                
                const scriptBox = `
                    <div class="${boxClass}">
                        <div class="script-box-header">
                            <span class="script-box-label">${label}</span>
                        </div>
                        <div class="script-box-content">"${cleanQuote}"</div>
                    </div>
                `;
                html = html.replace(quote, scriptBox);
            });

            // Clean up remaining content
            html = html
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n\n/g, '<br><br>')
                .replace(/\n/g, '<br>');

            return html;
        }

        function formatAsChecklist(content) {
            // Parse numbered items or bullet points
            const items = content.split(/\n/).filter(line => 
                line.match(/^\d+[\.\)]\s*/) || line.match(/^[-‚Ä¢]\s*/)
            );

            if (items.length === 0) {
                // Try to split by sentences if no clear list
                return formatContent(content);
            }

            const listItems = items.map(item => {
                const cleanItem = item.replace(/^[\d\.\)\-‚Ä¢\s]+/, '').trim();
                return `
                    <li class="action-item">
                        <div class="action-checkbox"></div>
                        <div class="action-text">${cleanItem}</div>
                    </li>
                `;
            }).join('');

            // Get any intro text before the list
            const introMatch = content.match(/^(.*?)(?=\d+[\.\)]|\-|‚Ä¢)/s);
            const intro = introMatch ? formatContent(introMatch[1].trim()) : '';

            return `${intro}<ul class="action-checklist">${listItems}</ul>`;
        }

        // ============================================
        // REPORT ACTIONS
        // ============================================
        function openEmailModal() {
            // Pre-populate with captured email from gate
            if (capturedEmail) {
                document.getElementById('email-input').value = capturedEmail;
            }
            if (capturedName) {
                document.getElementById('name-input').value = capturedName;
            }
            document.getElementById('email-modal').classList.add('active');
            document.getElementById('email-input').focus();
        }

        function closeEmailModal() {
            document.getElementById('email-modal').classList.remove('active');
        }

        async function sendEmailReport() {
            const email = document.getElementById('email-input').value.trim();
            const name = document.getElementById('name-input').value.trim();

            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address.');
                return;
            }

            closeEmailModal();
            
            const loading = document.getElementById('loading');
            document.getElementById('loading-text').textContent = 'Sending your report...';
            loading.classList.add('active');

            try {
                // For now, we'll save to localStorage and show success
                // In production, this would call a backend to send email
                const reportData = {
                    email: email,
                    name: name,
                    mode: currentMode,
                    answers: answers,
                    report: fullReportText,
                    timestamp: new Date().toISOString()
                };

                // Save locally
                const reports = JSON.parse(localStorage.getItem('zerodrama_reports') || '[]');
                reports.push(reportData);
                localStorage.setItem('zerodrama_reports', JSON.stringify(reports));

                // Track event
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'report_emailed', {
                        'event_category': 'engagement',
                        'event_label': currentMode
                    });
                }

                loading.classList.remove('active');
                showToast('Report saved! Email delivery coming soon.');

            } catch (error) {
                loading.classList.remove('active');
                alert('There was an error. Please try downloading the PDF instead.');
            }
        }

        function downloadPDF() {
            // Track event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'report_downloaded', {
                    'event_category': 'engagement',
                    'event_label': currentMode
                });
            }

            window.print();
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // ============================================
        // CHAT REFINEMENT
        // ============================================
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';

            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message bot';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = '<em>Thinking...</em>';
            document.getElementById('chat-messages').appendChild(typingDiv);

            try {
                const response = await callClaudeAPI(message);
                document.getElementById('typing')?.remove();
                addChatMessage(response, 'bot');
            } catch (error) {
                document.getElementById('typing')?.remove();
                addChatMessage('Sorry, I encountered an error. Please try again.', 'bot');
            }
        }

        function addChatMessage(content, type) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `chat-message ${type}`;
            div.innerHTML = formatContent(content);
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
    </script>
</body>
</html>
